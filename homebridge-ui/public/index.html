<link rel="stylesheet" href="styles.css">

<div id="app" class="container">
  <div class="row g-2">
    <div class="col-12 position-absolute top-0 start-50 translate-middle-x">
      <h1 class="text-center">Philips Ambilight TV Setup Wizard</h3>
    </div>
    <div class="col-12 text-center">
      <img src="ambilight-tv.jpg" alt="Philips Ambilight TV">
      <hr>
    </div>
  </div>
  <!-- Wizard Step 1: Device Discovery -->
  <div id="wizardStep1">
    <h5>Step 1: Discover Your TV</h5>
    <p class="text-muted">Click the button below to scan your network for Android TVs.</p>
    <div class="row g-2">
      <div class="col-12">
        <div id="discoveryAlert" class="alert alert-info mb-3">
          <i class="fas fa-info-circle"></i> Ensure your TV is powered on and connected to the same network as
          this device.
        </div>
      </div>
    </div>
    <div class="row g-2 mb-3">
      <div class="col-12">
        <button id="discoverBtn" class="btn btn-secondary">
          <span id="discoverSpinner" class="spinner-border spinner-border-sm ml-2"></span>
          <span id="discoverBtnText"><i class="fas fa-search"></i> Discover TVs</span>
        </button>
        <button id="cancelDiscoveryBtn" class="btn btn-primary">Cancel</button>
      </div>
    </div>
    <div id="deviceList" class="row g-2">
      <div id="deviceListContainer" class="col-12"></div>
    </div>
  </div>

  <!-- Wizard Step 2: Pairing -->
  <div id="wizardStep2" class="container">
    <div class="row g-2">
      <div class="col-12">
        <h5>Step 2: Pair with Your TV</h5>
        <div id="pinInputSection">
          <div class="alert alert-warning mb-3">
            <strong>Look at your TV!</strong> A 4-digit PIN code should be displayed on the screen.
          </div>
          <div class="mb-3 row">
            <label class="col-sm-3 col-form-label mt-2"><strong>Enter the PIN:</strong></label>
            <div class="col-sm-5">
              <div class="d-flex gap-2 mt-2" id="pinInputGroup">
                <input type="text" class="form-control form-control-lg text-center pin-digit" maxlength="1"
                  inputmode="numeric">
                <input type="text" class="form-control form-control-lg text-center pin-digit" maxlength="1"
                  inputmode="numeric">
                <input type="text" class="form-control form-control-lg text-center pin-digit" maxlength="1"
                  inputmode="numeric">
                <input type="text" class="form-control form-control-lg text-center pin-digit" maxlength="1"
                  inputmode="numeric">
              </div>
            </div>
          </div>
        </div>
        <div class="col-12">
          <button id="submitPinBtn" class="btn btn-success btn-block btn-lg">Confirm PIN</button>
          <button id="cancelPairingBtn" class="btn btn-secondary btn-block">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Wizard Step 3: Confirm Details -->
  <div id="wizardStep3" class="container">
    <div class="row g-2">
      <div class="col-12">
        <h5>Step 3: Confirm TV Details</h5>
        <div class="alert alert-success mb-3">
          <i class="fas fa-check-circle"></i> Pairing successful! Please review and customize the TV details below.
        </div>
        <form id="confirmTvForm" class="needs-validation" novalidate>
          <div class="mb-3 row">
            <label for="confirmTvName" class="col-sm-3 col-form-label">TV Name</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="confirmTvName" placeholder="Living Room TV" required>
              <div class="invalid-feedback">Please provide a TV name.</div>
              <small class="form-text text-muted">This name will appear in HomeKit.</small>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="confirmTvIp" class="col-sm-3 col-form-label">IP Address</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="confirmTvIp" readonly>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="confirmTvMac" class="col-sm-3 col-form-label">MAC Address</label>
            <div class="col-sm-9">
              <div class="input-group">
                <input type="text" class="form-control" id="confirmTvMac" placeholder="AA:BB:CC:DD:EE:FF">
                <button class="btn btn-secondary" type="button" id="confirmGetMacBtn">
                  <i class="fas fa-search"></i> Get MAC
                </button>
              </div>
              <small class="form-text text-muted">Required for Wake-on-LAN functionality.</small>
            </div>
          </div>
          <hr>
          <div class="col-12">
            <button id="saveTvBtn" class="btn btn-success" type="submit">
              <i class="fas fa-save"></i> Save TV
            </button>
            <button id="cancelConfirmBtn" class="btn btn-secondary" type="button">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Success Screen -->
  <div id="successScreen">
    <h5>Configured TVs</h5>
    <div id="noTvsMessage" class="alert alert-info mb-3">No TVs configured yet.</div>
    <ul id="configuredTvList" class="list-group mb-3"></ul>
    <button id="addAnotherTvBtn" class="btn btn-primary btn-block">
      <i class="fas fa-plus"></i> Add Another TV
    </button>
  </div>

  <!-- Edit TV Screen -->
  <div id="editScreen">
    <h5>Edit TV Configuration</h5>
    <div class="alert alert-info">
      <small><i class="fas fa-info-circle"></i> You cannot edit username/password. To change authentication, delete this
        TV and pair it again.</small>
    </div>
    <form id="editTvForm" class="needs-validation" novalidate>
      <div class="mb-3 row">
        <label for="editTvName" class="col-sm-3 col-form-label">TV Name</label>
        <div class="col-sm-9">
          <input type="text" class="form-control" id="editTvName" placeholder="Living Room TV" required>
          <div class="invalid-feedback">Please provide a TV name.</div>
        </div>
      </div>
      <div class="mb-3 row">
        <label for="editTvIp" class="col-sm-3 col-form-label">IP Address</label>
        <div class="col-sm-9">
          <input type="text" class="form-control" id="editTvIp" placeholder="192.168.1.100" required>
          <div class="invalid-feedback">Please provide an IP address.</div>
        </div>
      </div>
      <div class="mb-3 row">
        <label for="editTvMac" class="col-sm-3 col-form-label">MAC Address</label>
        <div class="col-sm-9">
          <div class="input-group">
            <input type="text" class="form-control" id="editTvMac" placeholder="AA:BB:CC:DD:EE:FF" required>
            <button class="btn btn-secondary" type="button" id="getMacBtn">
              <i class="fas fa-search"></i> Get MAC
            </button>
            <div class="invalid-feedback">Please provide a MAC address.</div>
          </div>
        </div>
      </div>
      <hr>
      <div class="col-12">
        <button id="saveEditBtn" class="btn btn-success" type="submit">Save</button>
        <button id="cancelEditBtn" class="btn btn-primary" type="button">Cancel</button>
      </div>
    </form>
  </div>

  <!-- Edit Sources Screen -->
  <div id="editSourcesScreen">
    <h5><i class="fas fa-tv"></i> Edit Sources for <span id="editSourcesTvName"></span></h5>
    <div class="alert alert-info mb-3">
      <small><i class="fas fa-info-circle"></i> Drag and drop sources to change their display order in HomeKit.
      Toggle visibility to show/hide sources. Changes are saved automatically.</small>
    </div>
    <div id="sourcesLoadingSpinner" class="text-center my-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2 text-muted">Fetching sources from TV...</p>
    </div>
    <div id="sourcesListContainer" style="display: none;">
      <div class="mb-3">
        <small class="text-muted">
          <i class="fas fa-grip-vertical"></i> Drag to reorder |
          <i class="fas fa-eye"></i> Click eye to toggle visibility
        </small>
      </div>
      <ul id="sourcesList" class="list-group sources-sortable mb-3"></ul>
      <div class="d-flex justify-content-between">
        <button id="resetSourcesOrderBtn" class="btn btn-outline-secondary">
          <i class="fas fa-undo"></i> Reset Order
        </button>
        <button id="doneEditSourcesBtn" class="btn btn-primary">
          <i class="fas fa-check"></i> Done
        </button>
      </div>
    </div>
    <div id="sourcesErrorContainer" class="alert alert-warning" style="display: none;">
      <i class="fas fa-exclamation-triangle"></i> <span id="sourcesErrorMessage"></span>
      <button id="retryLoadSourcesBtn" class="btn btn-warning btn-sm mt-2">
        <i class="fas fa-redo"></i> Retry
      </button>
    </div>
  </div>
</div>

<script src="app.js"></script>
